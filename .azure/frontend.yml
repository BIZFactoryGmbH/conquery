trigger:
- master

variables:
  EXCLUDE_SOURCE_MAPS: true
  MVN_CFG: -B -V -Dmaven.repo.local=$(Build.Repository.LocalPath)/cache/.m2
  YARN_CACHE_FOLDER: $(Build.Repository.LocalPath)/cache/yarn/
pool:
  vmImage: 'ubuntu-latest'

steps:
# - task: 1ESLighthouseEng.PipelineArtifactCaching.RestoreAndSaveCacheV1.RestoreAndSaveCache@1
#   inputs:
#     keyfile: 'frontend/yarn.lock'
#     targetfolder: cache
#     vstsFeed: $(ArtifactFeed)

- task: Maven@3
  displayName: build root
  inputs:
    jdkVersionOption: '1.11'
    goals: install
    options: $(MVN_CFG) -T 1C -N

- task: Maven@3
  displayName: frontend tests
  inputs:
    jdkVersionOption: '1.11'
    goals: test
    options: $(MVN_CFG) -pl frontend-resources

- task: DeleteFiles@1
  displayName: prepare cache
  inputs:
    sourceFolder: cache/.m2/repository/com/bakdata
    contents: '**'